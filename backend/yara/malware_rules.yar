rule Mobile_Application_Files {
    meta:
        description = "Detects common mobile application file formats for Android and iOS"
        author = "Your Name"
        date = "2023-11-15"
        version = "1.0"
        reference = "Internal use"

    strings:
        // Android APK signatures
        $apk_magic = "PK"  // ZIP file signature (APK is a ZIP format)
        $android_manifest = "AndroidManifest.xml"
        
        // iOS IPA signatures
        $ipa_magic = "PK"  // IPA is also a ZIP format
        $payload_dir = "Payload/"
        $info_plist = "Info.plist"
        
        // AAB (Android App Bundle) signatures
        $aab_magic = { 41 6E 64 72 6F 69 64 20 41 70 70 20 42 75 6E 64 6C 65 } // "Android App Bundle"
        
        // XAPK/OBB signatures
        $obb_magic = { 78 70 61 6B 00 } // "xpak\0"
        
        // Common mobile code patterns
        $dart_string = "dart"  // Flutter apps
        $react_native = "react-native"
        $cordova_string = "cordova"
        $xamarin_string = "xamarin"

    condition:
        // Detect APK files
        (uint16(0) == 0x4B50 and $android_manifest) or
        
        // Detect IPA files
        (uint16(0) == 0x4B50 and $payload_dir and $info_plist) or
        
        // Detect AAB files
        ($aab_magic in (0..100)) or
        
        // Detect OBB/XAPK files
        ($obb_magic in (0..100)) or
        
        // Detect mobile frameworks in file content
        (any of ($dart_string, $react_native, $cordova_string, $xamarin_string))
}